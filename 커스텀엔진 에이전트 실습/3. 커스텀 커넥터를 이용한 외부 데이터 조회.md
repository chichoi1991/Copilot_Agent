# 📡커스텀 커넥터를 이용한 외부 데이터 조회

## 1. 커넥터(Connector)란?

Copilot Studio에서 **커넥터**는 외부 시스템과 통신하기 위한 **사전 정의된 API 인터페이스**입니다. Microsoft에서 기본적으로 제공하며, 다양한 SaaS 서비스와의 통합을 쉽게 구현할 수 있습니다.

- **정의**: 외부 서비스와의 통합을 위한 미리 구성된 API 연결
- **사용 예시**:
  - Outlook 일정 조회
  - SharePoint 문서 검색
  - Teams 메시지 전송
- **주요 특징**:
  - 인증 방식 내장 (OAuth2.0 등)
  - 다양한 서비스와 즉시 연결 가능
  - Power Platform과도 연동 가능

## 2. 커스텀 커넥터(Custom Connector)란?

**커스텀 커넥터**는 기본 커넥터로는 지원되지 않는 **고유한 API 또는 사내 시스템**과의 통합을 위해 사용자가 직접 정의하는 커넥터입니다.

- **정의**: 사용자 또는 조직이 직접 정의한 API 연결
- **사용 목적**:
  - 사내 시스템 연동
  - 서드파티 API 통합
  - 특수한 인증 방식 적용
- **구성 요소**:
  - API 엔드포인트
  - 인증 방식 (API Key, OAuth 등)
  - 요청/응답 스키마

## 3. 커넥터를 사용하는 경우

|사용 | 예제 시나리오 | 
|-|-|
|외부 서비스와 데이터 연동 필요| CRM에서 고객 정보 가져오기| 
|자동화된 작업 흐름 필요 | 이메일 수신 시 DB에 기록 |
| Copilot이 특정 시스템의 데이터를 기반으로 응답해야 할 때 | ERP 시스템의 재고 정보 기반 응답 |

## 4. 커넥터 사용의 효과

|효과 | 설명|
|-|-|
|🔗 시스템 간 통합다양한 SaaS 및 온프레미스 시스템과 연결 가능| ⚡ 자동화 및 생산성 향상 | 반복 작업을 자동화하여 업무 효율 증가 |
| 🧠 Copilot의 응답 지능 향상 | 실시간 데이터 기반으로 더 정확한 응답 생성 |
| 🔒 보안 및 인증 관리 | OAuth2.0, API Key 등 다양한 인증 방식 지원 |

---

## 5. 실습 - 커스텀 커넥터 시나리오

지금부터 커스텀 커넥터를 생성하고 에이전트에 연결하는 실습을 해 보도록 하겠습니다. <br>

실습 시나리오는 다음과 같습니다.
- 사내 데이터를 통해 조회된 국가 코드를 기반으로 외교부에서 제공하는 국가 정보, 사건사고 데이터를 조회합니다. <br> 이후 출력 포멧에 맞추어 Agent가 내용을 정리하여 답변하도록 합니다.

외부 API 실습에는 [공공데이터포털](https://www.data.go.kr/) 에서 제공하는 데이터를 활용합니다.<br> 공공 데이터 포털은정부에서 운영하는 공공데이터 포털입니다. 회원가입 이후 필요 데이터를 무료로 이용할 수 있습니다. <br> <br>

<img width="1282" height="881" alt="image" src="https://github.com/user-attachments/assets/eae5abfc-c2f8-43e2-b667-07b8212c76e0" />


🌟실습에 사용될 데이터 정보는 다음과 같습니다.
1. [외교부_국가·지역별 경제현황](https://www.data.go.kr/data/15099538/openapi.do): ISO국가코드를 이용하여 국가·지역별 경제현황 정보를 조회 합니다.
2. [외교부_국가∙지역별 사건사고 유형](https://www.data.go.kr/data/15076236/openapi.do): ISO국가코드를 이용하여 사건 사고가 발생한 국가명, 발생년도, 사건사고 유형 및 사고 내용에 대한 상세 정보를 조회합니다.
<br>

> ⚠️주의⚠️ 이번 실습에서는 편의를 위해 미리 생성된 인증키를 통해 실습을 진행합니다. <br> 이 인증키는 실습이 끝나고 이용이 불가하기 때문에 지속적으로 이용이 필요할 경우, 공공데이터포털에서 [활용신청] 을 선택하여 개별로 API 인증키를 발급받으셔야 합니다.
<img width="1295" height="601" alt="image" src="https://github.com/user-attachments/assets/6b978583-31c0-439c-9f71-374e16c1ec78" />

---
## 6. 실습 - 커스텀 커넥터 생성

그럼 지금부터 실습을 시작해 보도록 합니다. 이번 세션에서 활용할 공공데이터 포털 API 인증키 정보 입니다.
### <br> 🏆🏆**API Key 정보**🏆🏆 <br> 
```
🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆TBD🏆
```

먼저 **[도구]** 섹션에서 **[+도구 추가]** 를 클릭합니다.
<img width="959" height="203" alt="image" src="https://github.com/user-attachments/assets/8cc797d5-dadb-4bd5-aa94-58c47d5c9334" />
<br> <br> 
이곳 도구 선택창에서 Agent가 사용할수 있는다양한 도구(API 커넥터)를 선택할 수 있습니다. <br> 지금은 커넥터를 제공하지 않는 시스템을 호출해야 하기때문에 커스텀 커넥터를 생성해야하며, 이를 위해 우측 중간에 **[+ 새로운 도구]** 를 선택합니다.
<img width="1019" height="626" alt="image" src="https://github.com/user-attachments/assets/216a6315-6a16-432d-b3e2-3ce5148d4937" />
<br> <br>
새로운 도구 선택창에서 [사용자 지정 커넥터] 를 선택하면, [Power apps](https://make.powerapps.com/customconnectors) 창이 생성되며 리다이렉트 됩니다.
<img width="1025" height="461" alt="image" src="https://github.com/user-attachments/assets/d50677b0-136a-4645-bc31-28af8485f7b4" />
<br> <br>

Power apps 페이지에 우측 상단의 **[+ 새 사용자 지정 커넥터]** 를 선택후, **[처음부터 만들기]** 를 선택합니다.
<img width="1721" height="547" alt="image" src="https://github.com/user-attachments/assets/926c070c-b85d-48ed-a31d-8c2bdd9f9a5a" />

다음으로 커넥터 이름을 입력하고 **[계속]** 을 선택합니다.
> **⚠️주의⚠️ 반드시 영어로 작성해야 합니다.**
```
MOFA-CountryData
```
<img width="1486" height="765" alt="image" src="https://github.com/user-attachments/assets/3013ec84-fde6-457a-be92-a6223a44b21a" />
<br> <br>

커넥터의 일반정보에 **설명**과 **호스트**를 아래 값을 입력하고 다음 단계** [보안] **으로 이동합니다. (기준 URL을 그대로 둡니다.)
- 설명 <br> 
```
ISO국가코드를 이용하여 국가·지역별 경제현황 정보를 조회 합니다.
```
- 호스트 <br>
```
apis.data.go.kr
```
<img width="1357" height="930" alt="image" src="https://github.com/user-attachments/assets/725792ad-f254-4a3f-b0cd-fe7c76790cc2" />
<br> <br>

## 7. 실습 - 보안 및 Request/Response 형식 정의

보안에서는 API의 인증형식을 지정할 수 있습니다. <br>
커넥터를 여러 사용자가 사용하고, 사용자마다 서로 다른 API키를 입력해야 하는 경우에는 **[API키]**, **[OAuth 2.0]** 등을 선택합니다. <br>
이번 세션에서는 쿼리에 API키가 함께 포함되어 호출이 되는 구조이므로 **[인증 없음]** 을 선택하고, 다음 **[정의]** 단계에서 
API키를 직접 입력토록 합니다.
<img width="1218" height="374" alt="image" src="https://github.com/user-attachments/assets/75f93606-ab0c-40e2-93c2-23a75a33cb6d" />
<br> <br>
정의 단계에서 **[+ 새동작]** 을 클릭하여, API 호출을 정의합니다. <br>
<img width="1291" height="925" alt="image" src="https://github.com/user-attachments/assets/95e2129c-0565-4f39-86a8-567149752864" />

이후 다음 정보를 입력합니다.
| | |
|-|-|
|요약|GetOverviewEconomicService|
|**설명**|국가·지역별 경제현황 정보를 제공합니다. ISO 2자리 국가코드를 이용하여 국가·지역별 경제현황 목록 조회합니다.|
|**작업ID**|GetOverviewEconomicService|
|**표시 여부**|important|

<img width="1140" height="583" alt="image" src="https://github.com/user-attachments/assets/5f622f76-f972-4646-bda7-7b47daac45f4" />

<br>

다음은 요청에서 **[+ 샘플에서 가져오기]** 를 선택하여 API 호출 쿼리를 지정합니다.
이곳에서는 실제 API가 호출될 때의 URL정보를 입려하여 API Endpoint, 쿼리를 직접 선언하지 않더라도 자동으로 파싱하여 빠르게 커넥터를 생성할 수 있도록 만들어 줍니다.
<img width="723" height="155" alt="image" src="https://github.com/user-attachments/assets/1d56a006-c977-4b11-ac30-c9b274b4a858" />

<br> <br>
좌측 패널에 다음의 값을 입력하고 [가져오기] 를 선택합니다.
- **동사**: **Get**
- **URL**: 아래 정보를 붙여넣습니다. (헤더는 공란으로 유지합니다.)
```
https://apis.data.go.kr/1262000/OverviewEconomicService/OverviewEconomicList?serviceKey=########API Key######&numOfRows=10&pageNo=1&cond[country_iso_alp2::EQ]=US
```
<img width="1291" height="704" alt="image" src="https://github.com/user-attachments/assets/e59b7508-c10b-4bdc-a147-4855cb12e432" />

<br> <br>

다음은 Request 쿼리의 정보를 수정합니다.<br>
해당 정보는 Copilot studio 에서 도구의 Input으로 관리할 수도 있으나, 편의를 위해 Power apps 아래와 같이 설정합니다.<br>
> ⚠️⚠️ **별도 언급이 없는 데이터는 기본 설정,값 그대로 유지합니다.** ⚠️⚠️

|쿼리|기본값|필요여부|표시여부|
|-|-|-|-|
|serviceKey|[API Key](https://github.com/chichoi1991/Copilot_Agent/edit/main/%EC%BB%A4%EC%8A%A4%ED%85%80%EC%97%94%EC%A7%84%20%EC%97%90%EC%9D%B4%EC%A0%84%ED%8A%B8%20%EC%8B%A4%EC%8A%B5/3.%203.%20%EC%BB%A4%EC%8A%A4%ED%85%80%20%EC%BB%A4%EB%84%A5%ED%84%B0%EB%A5%BC%20%EC%9D%B4%EC%9A%A9%ED%95%9C%20%EC%99%B8%EB%B6%80%20%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EC%A1%B0%ED%9A%8C.md#-api-key-%EC%A0%95%EB%B3%B4-)를 입력합니다.|예|Internal|
|numOfRows|10|예|Internal|
|PageNo|1|예|Internal|
|cond[country_iso_alp2::EQ]|공란유지|아니요|none or important|
<br> <br> 
설정하려는 쿼리를 클리하면 각 쿼리의 변수 설정창으로 이동하게 됩니다. 
<img width="845" height="759" alt="image" src="https://github.com/user-attachments/assets/327e9c67-71e1-4212-bbad-27b42cf12508" />
<br> <br> 
값을 모두 입력하고 상단의 [<-뒤로] 를 누르면 자동으로 저장된 채로 돌아옵니다.
<img width="1286" height="1018" alt="image" src="https://github.com/user-attachments/assets/b0164eb1-a336-42a7-81fe-c339d6b65f06" />

Request 쿼리 정보 수정을 마쳤으면, 스크롤을 내려 **Reponse** 형식을 정의 합니다. <br>
여기서는 API를 호출하고 반환받은 정보를 샘플로 입력하여, 실제 API Response의 파라미터를 빠르게 정의할 수 있습니다.
Response(응답) 영역에 있는 **[Default]** 를 클릭 합니다.
<img width="873" height="246" alt="image" src="https://github.com/user-attachments/assets/23643d03-e318-400e-9a1e-0c9b46f63994" />
<br> <br> 

응답 설정에서 **[+샘플에서 가져오기]** 를 선택합니다.
<img width="1319" height="378" alt="image" src="https://github.com/user-attachments/assets/a9970768-2d42-49cc-ac5b-5ab9bfdfd8e2" />
<br> <br>

이후 헤더는 공란을 유지하고, **[본문]** 에 아래 API 응답 샘플을 붙여넣고 **[가져오기]** 를 선택합니다.
<img width="1359" height="674" alt="image" src="https://github.com/user-attachments/assets/e31e2f19-b3fe-45a9-a424-bbde9d1e751a" />
<br> <br>

가져오기가 완료되면 다음과 같이 본문의 Response 페이로드가 표시되며, 상단의** [<-뒤로]** 를 선택하여 본문으로 돌아옵니다.
<img width="1341" height="789" alt="image" src="https://github.com/user-attachments/assets/1bdbd12d-9fc4-4ade-8536-c5a2981290f1" />
<br> <br> 
마지막으로 상단의 **[커넥터 만들기]** 를 선택하여 설정한 커넥터를 생성합니다.
<br> 
생성이 완료되면 **5.테스트** 에서 실제로 API가 호출이 되는지 확인할 수 있습니다. <br> 
**[연결]** 에서 **[+새연결]** 을 선택하여 새로운 커넥터 연결을 추가합니다.
<img width="1230" height="399" alt="image" src="https://github.com/user-attachments/assets/f789e807-b913-4af2-bf87-2a83ff083838" />
<br> 
> 추가가 되면, 연결 페이지로 이동하게 됩니다. 다시 커스텀 커넥터로 이동을 하려면 좌측 패널에서 커스텀커넥터를 선택합니다. <br> 만약 커스텀 커넥터가 보이지 않는다면, **더보기** 를 선택, 이후 **[모두 살펴보기]** 를 클릭하여 검색으로 이동후, **[데이터]** 항목에 **[사용자 지정 커넥터]** 를 선택 또는 고정 후 선택하여 이동할 수 있습니다.
<img width="660" height="721" alt="image" src="https://github.com/user-attachments/assets/fe7cf46b-2d25-45bd-a87e-ca876f5efb06" />
<img width="978" height="642" alt="image" src="https://github.com/user-attachments/assets/0abce34c-c43c-41bb-a39b-1968488e7a4c" />

<br> <br> 

## 8. 실습 - 커넥터 동작 테스트

이제 실제 API호출 테스트를 위해 사용자 지정 커넥터로 이동하여 생성하였던 MOFA-countryData 커넥터를 선택합니다.
<img width="1176" height="680" alt="image" src="https://github.com/user-attachments/assets/d83d34ac-c3f0-4dff-b1af-3d5e0682d4e4" />

<br> <br>
다음으로 우측 상단의 [편집]을 선택한 후 [5.테스트] 를 클릭하여 이동합니다.
<img width="1301" height="337" alt="image" src="https://github.com/user-attachments/assets/bdb3838e-b9d2-4563-9a6d-be5f64954359" />
<br> <br> 

테스트에는 방금 연결한 연결정보가 표시되고 있으며, 
작업에는 **cond[country_iso_alp2::EQ]** 파라미터에 대한 값을 입력 받도록 되어있습니다.
테스트를 위해 해당 값에 ```US``` 를 입력하고 **[테스트 작업]** 을 클릭합니다.
<img width="1185" height="806" alt="image" src="https://github.com/user-attachments/assets/4cab9ba1-96ce-4e86-b2cd-1b09a47ba92e" />

호출이 성공적으로 완료되면, 아래 이미지와 같이 200 응답과 함께 Body(본문)에 미국에 관련된 정보가 표시됩니다.
<img width="976" height="767" alt="image" src="https://github.com/user-attachments/assets/d533da9b-ab1b-4474-9042-eab6f29c634e" />

---
## 9. 실습 - 추가 커넥터 생성

국가 정보를 조회하는 커넥터가 생성되었다면, 다음은 같은 커넥터에서 **[+새 동작]** 선택하여,  앞서 진행한 동일한 작업을 실행해 국가별 사건사고 현황 호출 API를 조회할 수 있도록 만듭니다.
<img width="1298" height="628" alt="image" src="https://github.com/user-attachments/assets/1287f7ae-15b1-4775-92c3-3552a62f2980" />
<br> <br> 

**일반 설정**
| | |
|-|-|
|**설정 작업**|**값**|
|요약|GetCountryAccidentService|
|설명|국가·지역별 사건 사고 정보를 제공합니다. ISO 2자리 국가코드를 이용하여 국가·지역별 사건 사고 목록을 조회합니다.|
|작업ID|GetCountryAccidentService|
|표시여부|Important|

<br> <br> 

**요청(Request) 정보**
- 요청 URL
```
https://apis.data.go.kr/1262000/CountryAccidentService2/CountryAccidentService2
```

<br> <br> 

- 쿼리 정보

|쿼리|기본값|필요여부|표시여부|
|-|-|-|-|
|serviceKey| [API Key](https://github.com/chichoi1991/Copilot_Agent/edit/main/%EC%BB%A4%EC%8A%A4%ED%85%80%EC%97%94%EC%A7%84%20%EC%97%90%EC%9D%B4%EC%A0%84%ED%8A%B8%20%EC%8B%A4%EC%8A%B5/3.%203.%20%EC%BB%A4%EC%8A%A4%ED%85%80%20%EC%BB%A4%EB%84%A5%ED%84%B0%EB%A5%BC%20%EC%9D%B4%EC%9A%A9%ED%95%9C%20%EC%99%B8%EB%B6%80%20%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EC%A1%B0%ED%9A%8C.md#-api-key-%EC%A0%95%EB%B3%B4-)를 입력합니다.|예|Internal|
|returnType|Json|예|Internal|
|numOfRows|10|예|Internal|
|PageNo|1|예|Internal|
|cond[country_iso_alp2::EQ]|공란유지|아니요|none or important|

<br> <br> 

- 응답 정보
```
{"response":{"body":{"dataType":"JSON","items":{"item":[{"continent_cd":"30","continent_eng_nm":"Europe","continent_nm":"유럽","country_eng_nm":"Russia","country_iso_alp2":"RU","country_nm":"러시아","dang_map_download_url":"https://www.0404.go.kr/files/download/COUNTRY_39/3","flag_download_url":"https://opendata.mofa.go.kr:8444/fileDownload/images/country_images/flags/50/20220729_092800113.png","map_download_url":"https://opendata.mofa.go.kr:8444/fileDownload/images/country_images/maps/50/20220729_092800180.png","news":"\u003cdiv\u003e\r\n\u003ch3 class=\"tit\"\u003e사건ㆍ사고의 유형\u003c/h3\u003e\r\n[모스크바]\u003cbr\u003e\r\nㅇ 현지 치안 상황 : 러시아 전역의 치안은 과거에 비해 전반적으로 안정화 되었으나, 수도 모스크바 및 주요 도시를 중심으로 우리 국민 여행객 수도 늘어남에 따라 절도·분실 사건 및 강도·폭행 사건 수가 증가하고 있는 추세이오니, 여행 시 유의하시기 바랍니다.\u003cbr\u003e\u003cbr\u003e\r\n\r\n[주요사건 사고 유형 및 예방안내]\u003cbr\u003e\r\nㅇ 러시아 도로변 호객 택시정식으로 등록되지 않은 택시 이용시 바가지 요금 시비가 많으므로 Gett, Yandex taxi 등 휴대전화 어플을 사용하여 정식 인가된 택시를 이용하시기 바랍니다.\u003cbr\u003e\r\nㅇ 특히, 공항 입국장 앞(호객 기사 주의), 시내 도로변에 서 있는 택시는 탑승하지 마시고 공항 정식택시 창구 및 숙박업소등을 통해 택시를 예약하여 이용하시기 바랍니다. 또한 과다 청구를 대비하여 사전에 요금제를 확인하시기 바랍니다.\u003cbr\u003e\r\nㅇ 모스크바 및 주요도시에서 외국인을 대상으로 하는 소매치기기 범죄가 빈번하게 발생하고 있습니다. 특히 주요관광지, 기차 및 지하철내에서 현금이나 고가의 휴대폰 등을 소지한 관광객을 대상으로 한 범죄가 많으니 여행하실 때 소지품 도난·분실에 주의해 주시기 바랍니다.\u003cbr\u003e\r\n\u003cp style=\"margin-left: 25px; margin-right: 25px;\"\u003e※ 도난 및 분실사고 발생 시 현지 경찰신고 절차가 복잡할 뿐만 아니라, 피해회복 또한 어렵다는 점을 잘 인식하시어 사전 예방에 힘써 주시기 바랍니다.\u003c/p\u003e\r\nㅇ 러시아 국경수비대는 러시아에 무사증으로 입국하여 벨라루스를 여행하거나 벨라루스를 경유하여 제3국에 갔다가 러시아로 돌아온 외국인이 출국하려는 경우, 러시아에서 출국했던 기록(여권 상 출국심사인 날인)이 없다는 이유로, 벨라루스 등 제3국에서 체류하였던 기간까지 모두 합산하여 사증면제협정등에서 허용하는 체류기간을 도과한 경우 불법체류한 것으로 판단하여 출국을 제지하는 사례가 발생하고 있습니다.\u003cbr\u003e\r\n\u003cp style=\"margin-left: 25px; margin-right: 25px;\"\u003e※ 벨라루스 비자, 거주등록, 러시아~벨라루스 간 항공권, 벨라루스 출입국기록(확인스템프)등을 제시하더라도 국경수비대에서는 여권 상 출국심사인 이외의 자료를 가지고는 공식적으로 출국기록을 인정하지 않음\u003c/p\u003e\r\nㅇ 이에 벨라루스를 여행하시려는 우리 국민께서는 러시아 이외의 국가를 경유하여 출입국하실 것을 권장하며, 특히 러시아로 입국한 경우 벨라루스를 경유하여 제3국 출국 또는 국내로 귀국시에는 러시아 출국기록이 전산 등에 남아있지 않아 이후 러시아 재입국시 문제가 발생할 소지가 있으니 유의하시기 바랍니다.\u003cbr\u003e\u003cbr\u003e\r\n\r\n[블라디보스톡]\u003cbr\u003e\r\nㅇ 현지 치안 상황 : 블라디보스톡 등 러시아 극동지역의 치안은 과거에 비해 많이 안정화 되었으나 아직 여타지역에 비해 강력범죄 발생률이 높기때문에 심야시간대 외출은 (특히 여성 여행객 단독) 가급적 자제하시기 바랍니다.\u003cbr\u003e\r\nㅇ 주요사건 사고 유형\u003cbr\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003e- 소매치기 범죄 증가 : 아르바트 거리, 해양공원, 대형마트 등 외국인 관광객 밀집지역내 소매치기 범죄 발생 증가\u003cbr\u003e\r\n- 외국인 대상 택시 요금 시비 : 길거리 호객 택시 이용 대신 막심·얀덱스 등 택시 어플 이용 권장\u003cbr\u003e\r\n- 횡단철도 내 분실, 절도, 폭행 및 성추행 등 사건 발생 빈도 증가: 열차 내 개인소지품을 철저히 확인하며, 음주 승객등과의 시비에 주의\u003c/p\u003e\u003cbr\u003e\r\n\r\n[상트페테르부르크 주요 사건사고 유형]\u003cbr\u003e\r\n♣ 소매치기 사건\u003cbr\u003e\r\nQ1. 길을 가던중에 갑자기 4명이 애워싸고 3명이 길을 막은 후 한명이 가방이나 주머니에서 물건을 훔쳐 가는 사례\u003cbr\u003e\r\nQ2. 버스나 지하철 주요관광지 탑승시 덩치가 큰 사람이 탑승 입구를 막아서고 주변에 소매치기 일당들이 몰려와 물건을 강탈하는 사례 (주요관광지 입장권판매소에서도 동일한 수법으로 도난사고 발생)\u003cbr\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003eA. 주요 관광지 및 인파가 많은 곳을 이동시에는 항상 주변을 살피시고 본인의 주변에 이상한 사람들이 접근하는 지를 파악하시며 이동하실 것을 권장합니다.\u003c/p\u003e\r\n\u003cp style=\"margin-left: 25px; margin-right: 25px;\"\u003e- 스마트폰만 보고 다니신 다거나 이어폰을 끼고 음악에 빠져 있는 경우 소매치기범의 범행 대상이 되기 쉽습니다.\u003c/p\u003e\r\nQ3. 가방을 뒤로 메고 이동 시 소매치기들이 접근하여 가방을 열고 안에 물건을 꺼내가는 사례\u003cbr\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003eA. 인파가 많은 곳에서는 백팩은 앞으로 메주시고, 지퍼 자물쇠 사용 혹은 지퍼를 열기 쉽지 않게 끝 쪽으로 잠그시기 바랍니다.\u003c/p\u003e\r\nQ4. 책자 판매나 사인을 유도하며 한명이 주의를 끌고 나머지 일당이 소매치기하는 사례\u003cbr\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003eA. 관광지에서 낯선 사람들이 접근한다면 상대하지 마시고, 그 자리를 피하시기 바랍니다.\u003c/p\u003e\u003cbr\u003e\r\n\r\n\u003ch3 class=\"tit\"\u003e유의해야 할 지역\u003c/h3\u003e\r\n[철수 권고 지역]\u003cbr\u003e\r\nㅇ 체첸을 중심으로 한 북카프카스 지역(북오세티아, 잉구세티아, 다게스탄, 카바르디노 발카리아,북오세티아, 카라차예보체르케스카야, 아디게야)에서 폭탄 테러가 빈발하고 있어 우리 정부는 이 지역을 철수 권고(적색경보) 지역으로 지정하고 있습니다. 따라서 긴급한 용무 외에는 북카프카스 지역 방문을 자제하여 주시기 바라며, 부득이한 경우에는 주러시아 대사관 영사과에 여행 기간 및 연락처 등을 사전에 통보하여 주시기 바랍니다.\u003cbr\u003e\u003cbr\u003e\r\n\r\n[신변안전 유의 지역] \u003cbr\u003e\r\nㅇ 2021.1월 러시아 전역 대규모 시위, 2019.12월 모스크바 시내에서 괴한의 무차별  총격 사건,  2014.10월 체첸공화국 수도 그로즈니에서 자살폭탄테러, 2011. 1월 모스크바 도모제 도보 공항 폭탄 테러, 2010. 3월 모스크바 지하철역 연쇄 폭탄 테러  등 시내 중심부에서 시위 및  테러가 발생한 바 있습니다. 따라서 대규모 군중이 밀집한 장소나 공공장소에서는 신변안전에 각별히 유의하시기 바랍니다.\u003cbr\u003e\u003cbr\u003e\r\nㅇ 과거 사례를 살펴보면 스킨헤드 등에 의한 인종혐오 범죄가 발생하였고, 일몰시 지하철역 인근, 축구 경기장, 한적한 공원이나 거리 등은 범죄피해의 우려가 있으니 유의하시기 바라며 특히, 과거 외국인 혐오 범죄가 발생하였던 히틀러 생일(4.20), 전승 기념일(5.9), 국민 통합의 날(11.4) 등 기간에는 더욱 주의하여 주시기 바랍니다.\u003cbr\u003e\r\n\r\n[블라디보스톡 - 러시아 연해주 등 극동 지역]\r\nㅇ 독수리전망대 안전구역 밖 사진촬영 (추락사고), 겨울철 해빙기 바닷가 출입 (익사사고), 루스키 섬 트레킹 시 절벽 사진 촬영 (추락사고) 등\u003cbr\u003e\r\nㅇ 러시아 연해주 지방의 핫산 지역은 여행경보 1단계 (남색경보) 여행 유의지역(러시아·북한 국경 접경지역)으로 지정되어 운용 중에 있습니다.\u003cbr\u003e\r\n\u003cp style=\"margin-left: 25px; margin-right: 25px;\"\u003e※ 핫산등 출입제한구역의 경우 외국인은 방문 60일전 방문신청서를 지역관할 국경수비대에 제출하여 사전 허가를 받아야 합니다.\u003c/p\u003e\u003cbr\u003e\r\n\r\n[상트페테르부르크 - 주요 관광지 사건]\u003cbr\u003e\r\nQ1. 주요 관광지 방문시 동물탈 · 분장 · 비둘기 등으로 관광객들을 유인하여 사진을 찍고 난 후 터무니없는 사진 촬영비를 요구하는 사례\u003cbr\u003e\r\n\u003cp style=\"margin-left: 25px; margin-right: 25px;\"\u003e- 멀리서 다른 사진을 찍을 때도 본인들이 찍혔다고 주장하며 금품을 요구\u003c/p\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003eA. 동물탈 · 분장 · 비둘기 등으로 관광객을 대상으로 호객행위 중인 곳에서는 되도록이면 사진촬영을 자제하시기 바랍니다.\u003c/p\u003e\r\nQ2. 택시 및 교통편(마차나 말 등) 탑승 후 터무니 없는 가격을 요구하는 사례\u003cbr\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003eA. 택시는 공인된 앱(Yandex.Taxi, 우버, Bolt 등)을 통하여 이용하시는 것이 가격적으로도 저렴하고 안전합니다. 그리고 관광지에서 탈것을 이용할 시에는 탑승 전에 정확한 가격을 합의한 후에 탑승하시기 바랍니다.\u003c/p\u003e\r\nQ3. 노점상에서 물건 구입 후 카드 결제 시 카드를 복제하거나 또는 물건 구입 가격보다 높은 금액으로 결재하는 사례\u003cbr\u003e\r\n\u003cp style=\"margin-left: 15px; margin-right: 15px;\"\u003eA. 노점상에서는 카드 결제 대신 현금으로 구입하시는 것을 권장합니다.\u003c/p\u003e\u003c/div\u003e","wrt_dt":"2025-05-21"}]},"numOfRows":10,"pageNo":1,"totalCount":1},"header":{"resultCode":"0","resultMsg":"정상"}}}
```

작업을 완료하고 **[커넥터 업데이트]** 후 **[5.테스트]** 에서 2번째 작업 "GetCountryAccidentService" 를 선택하고 cond[country_iso_alp2::EQ]
값에 US를 입력하여 테스트를 진행하면 다음의 결과가 나옵니다.
<img width="1351" height="789" alt="image" src="https://github.com/user-attachments/assets/48124a42-a5f4-4f88-80f1-c098283360cf" />
<img width="1357" height="606" alt="image" src="https://github.com/user-attachments/assets/1d792d37-1d88-43b3-94e5-ccb190e64437" />

정상적으로 표시가 된다면 우측 상단의 [닫기] 를 누른후, <br> 다시 **Copilot Studio 탭**으로 이동합니다.
<img width="1238" height="303" alt="image" src="https://github.com/user-attachments/assets/dbf948e3-d24f-42a6-8fc2-2d2a5a8d4e5d" />

## 10. 실습 - 에이전트에 커스텀 커넥터 추가

Copilot studio 페이지로 이동하면, 도구 창에서 **[새로 고침]** 을 눌러줍니다.
<img width="1090" height="789" alt="image" src="https://github.com/user-attachments/assets/3789471a-62db-409e-8a8f-9f7091e9c566" />

<br> <br> 

이후 도구 검색에서 **mofa** 를 입력하여 앞서 생성한 커넥터가 검색이 되는지 검색합니다.
> 만약 검색이 잘 되지 않을 경우, 검색 버튼을 다시한번 더 클릭해 봅니다.

<img width="1067" height="413" alt="image" src="https://github.com/user-attachments/assets/f4b65d96-9c0d-4591-aeec-4ecb68f5f81b" />

검색된 커넥터 중 **GetOverviewEconomicService** 를 선택하여, **[에이전트에 추가]** 를 클릭합니다.
> 만약 연결이 없음으로 뜬다면, [새연결 만들기]를 선택하여 연결을 생성하고 이후 에이전트에 추가 합니다.

<img width="1067" height="413" alt="image" src="https://github.com/user-attachments/assets/16d6bb62-e92b-45c6-8505-5b1a52510aa5" />
<img width="1065" height="771" alt="image" src="https://github.com/user-attachments/assets/aaac8e8e-556e-4363-82a7-8e76225ce75d" />

<br> <br> 

도구에 추가된 커넥터 "GetOverviewEconomicService" 를 클릭하여 도구 상세 설정으로 이동합니다.
<img width="897" height="150" alt="image" src="https://github.com/user-attachments/assets/d914330f-8373-4887-88ff-6c2ae04c6bf8" />

<br> <br> 
도구에 설명을 다음과 같이 변경합니다.
```
국가·지역별 경제현황 정보를 제공합니다. ISO 2자리 국가코드를 이용하여 국가·지역별 경제현황 목록 조회합니다.
예) iso 2자리 국가코드를 입력합니다. 예) 미국=US, 일본=JP
```

<img width="816" height="318" alt="image" src="https://github.com/user-attachments/assets/6a79a00e-ca21-41fe-a626-8496dbd34c0f" />

<br> <br> 

다음으로 **[추가 세부 정보]** 를 선택하여 **[사용할 자격 증명]** 설정을 **[제작자 제공 자격 증명]** 으로 변경합니다.
<img width="803" height="434" alt="image" src="https://github.com/user-attachments/assets/176b5a6d-11a5-4075-855b-18a7ef0c3108" />

<br> <br> 

마지막으로 **[입력]** 세션에서 **[+ 입력 추가]** 를 선택, cond[country_iso_alp2::EQ]
를 변수 Input으로 추가합니다.
<img width="805" height="538" alt="image" src="https://github.com/user-attachments/assets/f635f9c5-57de-4e8c-88ba-3835f2e5bbde" />

<br> <br> 
⚠️⚠️**중요**⚠️⚠️ 현재 Input을 추가하면 추가된 변수 값이 **DuplicateItem** 이라는 에러가 발생하고 있습니다.
<img width="837" height="245" alt="image" src="https://github.com/user-attachments/assets/3be949df-cee5-4113-8ac1-6e377f8b93e7" />

<br> <br>
이 문제는 **[다음을 사용하여 채우기]** 의 **[AI로 동적으로 채우기]** 를 클릭하여 드랍다운 메뉴에서 **[사용자 지정값]** 으로 변경후, 다시 **[AI로 동적으로 채우기]** 원복할 경우, 문제가 해결됩니다.
<img width="869" height="263" alt="image" src="https://github.com/user-attachments/assets/e56cb9e9-0377-4400-9ecf-82116bdb46eb" />

에러를 해결하고 값에 있는 **"사용자 지정"** 을 선택하면 이 변수의 설명을 입력할 수 이습니다.
이 변수의 목적과 입력 포멧을 다음과 같이 입력후 상단의 저장버튼을 클릭하여 도구의 설정을 저장합니다.
```
iso 2자리 국가코드를 입력합니다. 예) 미국=US, 일본=JP
```

<img width="802" height="587" alt="image" src="https://github.com/user-attachments/assets/7432e7a4-f951-4fbc-aa51-f91e6ce214c5" />

## 11. 실습 - 에이전트에서 커넥터 동작 테스트

변경된 설정을 저장하고 상단의 **[개요]** 로 돌아가 이제 어떤 상황에서 도구를 사용해야하는지 지침을 수정하고 실제 테스트를 진행해 보도록 합니다. <br> 

지침의 내용을 아래와 같이 변경하고 저장 합니다. <br> 

> ⚠️⚠️**중요**⚠️⚠️  지침에서는 / 를 입력하여 토픽, 도구, 변수, 에이전트, Power fx 를 명시적으로 선언할 수 있습니다. 아래에 표현된 $GetOverviewEconomicService 는 실제 Copilot studio에서는 / 를 입려하여 도구를 선택하도록 합니다.

```
- 사용자가 입력한 국가명을 바탕으로 쉐어포인트에서 해당 국가의 ISO 코드를 검색합니다.
- 사용자가 지정하지 않을 경우,  ISO 2자리 코드(iso_alp2) 를 검색하며, 사용자가 명시적으로 요청시에는 국가의 영어이름(country_eng_nm), 한글이름(country_nm), id, iso 3자리 코드(iso_alp3), iso 번호(iso_num) 를 제공합니다.
- ISO 2자리 코드가 확인되면 커넥터를 통해 해당 국가의 상세 정보(인구, 면적, 수도 등)를 제공함
- 사용자가 국가명을 잘못 입력했을 경우, 올바른 국가명을 안내하고 재입력을 요청함
- 최신 정보 제공을 위해 항상 쉐어포인트와 커넥터를 우선적으로 활용함
- 사용자 질문에 친절하고 명확하게 응답함
- 민감하거나 제한된 정보는 제공하지 않음
- 국가 경제 정보에 대한 요청을 할 경우, $GetOverviewEconomicService 을 이용합니다.
- 복수의 국가에 대해 분석 및 정보를 요청할 경우, $GetOverviewEconomicService 을 N번씩 반복 수행 합니다.
```
<br> 
<img width="936" height="638" alt="image" src="https://github.com/user-attachments/assets/a2ccfdc8-1d30-49a1-b058-3c4e28bd1fc3" />

지침 수정이 변경되었으면, 실제로 쉐어포인트 데이터를 조회한 후 API를 호출하여 데이터를 조회하는지 프롬프트를 입력하여 확인해 봅니다.

```
미국과 일본의 경제 정보를 알려주고
둘의 차이를 비교해줘
```

> Agent를 통한 API 호출시 커다란 장점중 하나는, 여러번의 API호출 작업이 필요한 데이터 조회 업무도 자연어 한번으로 Agent가 스스로 연속해서 호출을 하여 데이터를 처리해 답변한다는 점 입니다. <br> 
**미국과 일본의 경제 정보를 알려주고 -> US, JP로 API 조회를 2번한 후, 결과물을 표시** <br>
**둘의 차이를 비교해줘 -> LLM을 통한 데이터 분석** <br>

<img width="1524" height="1174" alt="image" src="https://github.com/user-attachments/assets/6babcb18-bd20-4358-a231-a86c66e73008" />


---
---

테스트를 통해 정상적으로 커스텀 커넥터가 동작하는것을 확인하였다면, <br> 동일한 방식으로 **"GetCountryAccidentService"** 커넥터를 추가합니다.

<img width="1062" height="365" alt="image" src="https://github.com/user-attachments/assets/23a00bf6-619d-4155-ac2e-06aa8ed25b50" />
<br> <br> 

이후 다음과 같이 도구 설정을 한 후 저장해 줍니다. 
- 설명: 국가·지역별 사건 사고 정보를 제공합니다. ISO 2자리 국가코드를 이용하여 국가·지역별 사건 사고 목록을 조회합니다.
- 사용할 자격 증명: 제작자 제공 자격 증명
- 입력: cond[country_iso_alp2::EQ]
- 값: iso 2자리 국가코드를 입력합니다. 예) 미국=US, 일본=JP
<br> 
<img width="1060" height="1076" alt="image" src="https://github.com/user-attachments/assets/f36fb90b-1482-49e7-89d8-c8a5d54af801" />

<br> <br> 
도구 추가 및 설정이 완료되면, **[개요]** 로 이동하여 새로 추가된 도구에 대한 지침을 작성합니다.

```
- 사용자가 입력한 국가명을 바탕으로 쉐어포인트에서 해당 국가의 ISO 코드를 검색합니다.
- 사용자가 지정하지 않을 경우,  ISO 2자리 코드(iso_alp2) 를 검색하며, 사용자가 명시적으로 요청시에는 국가의 영어이름(country_eng_nm), 한글이름(country_nm), id, iso 3자리 코드(iso_alp3), iso 번호(iso_num) 를 제공합니다.
- ISO 2자리 코드가 확인되면 커넥터를 통해 해당 국가의 상세 정보(인구, 면적, 수도 등)를 제공함
- 사용자가 국가명을 잘못 입력했을 경우, 올바른 국가명을 안내하고 재입력을 요청함
- 최신 정보 제공을 위해 항상 쉐어포인트와 커넥터를 우선적으로 활용함
- 사용자 질문에 친절하고 명확하게 응답함
- 민감하거나 제한된 정보는 제공하지 않음
- 국가 경제 정보에 대한 요청을 할 경우, GetOverviewEconomicService  을 이용합니다.
- 국가의 사건 사고 정보를 요청할 경우, GetCountryAccidentService 을 이용합니다.
- 국가에 대한 분석을 요청할 경우, GetCountryAccidentService 과 GetOverviewEconomicService 을 2개 모두 이용하여 데이터를 조회한 후 해당 내용을 기반으로 보고서를 작성합니다.
- 복수의 국가에 대해 분석 및 정보를 요청할 경우, GetCountryAccidentService 과 GetOverviewEconomicService 을 N번씩 반복 수행 합니다.

**#사건 사고 정보 출력 형식**
각 단락마다 마크다운과 아이콘을 활용하여 시인성을 제공합니다.
아래 순서에 맞추어 답변 출력을 제공합니다.
- $국가 사건·사고 정보
- 🏳️국기: flag_download_url:  <img> 태그를 이용하여 이미지를 직접 렌더링 합니다. 
- 🗺️위치: map_download_url:  <img> 태그를 이용하여 이미지를 직접 렌더링 합니다.
---
- 🚨 사건·사고 현황
- 📍 유의해야 할 지역 및 유형
- 📝 주요 피해 사례 요약
---
- 🌪️ 자연 재해
---
- 🗺️ 위험지도: dang_map_download_url: <img> 태그를 이용하여 이미지를 직접 렌더링 합니다. 

**#국가 분석 내용 출력 형식**
각 단락마다 마크다운과 아이콘을 활용하여 시인성을 제공합니다.
아래 순서에 맞추어 답변 출력을 제공합니다.
- $국가 정보 분석
- 국기: flag_download_url:  <img> 태그를 이용하여 이미지를 직접 렌더링 합니다. 
- 위치: map_download_url:  <img> 태그를 이용하여 이미지를 직접 렌더링 합니다.
---
- 경제현황
---
- 사건 사고 유형 및 대처방안
- 유의해야 할 지역
- 주요 피해 사례 요약
---
- 자연재해
---
- 위험지도: dang_map_download_url: <img> 태그를 이용하여 이미지를 직접 렌더링 합니다.

```
<br> 
<img width="936" height="612" alt="image" src="https://github.com/user-attachments/assets/0acc550e-1826-44fe-9ee7-813cca68ce2e" />
<br> <br> 
지침을 모두 입력하였다면 아래 프롬프트를 통해 원하는 포멧에 맞추어 답변을 하는지 확인해 봅니다.
```
프랑스에 대해 분석해줘
```

<img width="1515" height="1231" alt="image" src="https://github.com/user-attachments/assets/586a7d30-9f1f-4195-9efb-efc0c0c61393" />

<br> <br> <br>

---

🎉🎉축하합니다🎉🎉 이번 세션을 완료하였습니다. <br>
다음 세션에서는 도구를 하나더 추가하고 지침을 통해 원하는 형식으로 답변을 할 수 있도록 만들어 봅니다.
