# 🔌MCP 커넥터 이용해보기
이번 세션에서는 MCP 커넥터를 이용하여 Agent에 메일 발신 기능을 추가해 보도록 하겠습니다.


## ❓ 1.What is MCP?

[Model Context Protocol (MCP)](https://modelcontextprotocol.io/introduction)는 애플리케이션이 LLM에 컨텍스트를 제공하는 방법을 표준화하는 오픈 프로토콜입니다. 이 프로토콜은 [Anthropic](https://www.anthropic.com/)에서 정의했습니다. MCP는 AI 모델을 다양한 데이터 소스와 도구에 연결하는 표준화된 방법을 제공합니다. 이를 통해 제작자는 기존 지식 서버와 API를 Copilot Studio에 직접 통합할 수 있습니다.

현재, Copilot Studio는 Tools(도구)만 지원합니다. 현재 기능에 대한 자세한 내용은 [aka.ms/mcsmcp](https://aka.ms/mcsmcp)를 참고하세요. 

<img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/8e074fea-dcb6-49f5-8bc2-e6d476b42e94" />

> 이미지와 관련된 원본은 [여기](https://www.claudemcp.com/ko/blog/mcp-vs-api)에서 참고할 수 있습니다.

## 🆚 2.MCP vs Connectors

✅ MCP는 언제 사용하나요?

AI 모델과 다양한 데이터 소스 또는 도구를 표준화된 방식으로 연결해야 할 때 사용합니다.
예를 들어, Copilot Studio에서 외부 API나 지식 서버를 직접 통합하고 싶을 때 MCP가 적합합니다.
MCP는 Model Context Protocol을 기반으로 하며, LLM이 컨텍스트를 이해하고 활용할 수 있도록 돕습니다.

✅ 커넥터는 언제 사용하나요?

Power Platform에서 기존의 **데이터 소스(예: Dynamics 365, SharePoint, SQL 등)**와 연결할 때 사용합니다.
커넥터는 비즈니스 애플리케이션 통합에 특화되어 있으며, 데이터 작업과 워크플로우 자동화에 강점이 있습니다.

✅ MCP가 커넥터를 대체하나요?

아니요. MCP는 커넥터를 대체하지 않습니다.
MCP 서버는 **커넥터 인프라**를 기반으로 제공되므로, 두 기술은 함께 사용됩니다.
MCP 서버는 커넥터 인프라를 활용해 엔터프라이즈 보안 및 거버넌스 제어를 적용할 수 있습니다:

- V-net 통합 기능: https://learn.microsoft.com/power-platform/admin/vnet-support-overview
- Power Platform DLP 정책: https://learn.microsoft.com/power-platform/admin/wp-data-loss-prevention
- Custom Connector 보호: https://learn.microsoft.com/connectors/custom-connectors/#2-secure-your-api

따라서 **MCP + 커넥터** = 더 강력한 통합입니다.

## 🛠️ 3.Copilot Studio Pre-built MCP Connector
MCP 서버와 커넥터를 직접 생성하여 운영하면, 회사 내부의 시스템을 조회하거나 외부의 시스템에 안전하게 접근할 수 있습니다. 
그렇지만, 모든 서비스를 직접 다 만들어 쓸수는 없기 때문에 많은 Service Provider는 자체적으로 MCP서버를 구축하여 커넥터를 배포하고 있고
Copilot studio에서도 몇가지 Pre-built 커넥터를 확인할 수 있습니다.

<img width="1026" height="744" alt="image" src="https://github.com/user-attachments/assets/1f283c3c-7ecd-454c-ae4f-1bf09a2a5b5d" />

> 엔터프라이즈 mcp 서버를 구축하고 커넥터를 만드는 자세한 설명은 [이곳](https://github.com/ChangJu-Ahn/mcsmcp-KR/blob/main/README.md) 을 참조해 주세요
> 

---

## 🌟 4. 실습
지금부터 Copilot Studio가 제공하는 Pre-built MCP중 하나인 Outlook Mail MCP 서버를 이용하여 에이전트에게 메일 발송기능을 부여해 보도록 하겠습니다.

<img width="891" height="1109" alt="image" src="https://github.com/user-attachments/assets/f9b213b6-7538-40f8-b7ce-e267f9aee8ee" />

> 이번 실습에는 MCP서버를 통해 메일 발송만 진행하지만,
실제 Outlook 메일 MCP 서버를 활용하면, 메일 읽기, 쓰기, 열람, 포워딩, 플래그등 각각의 작업별로 하나씩 커넥터를 생성 및 등록을 해주어야 하는 번거로운 일을 하지 않고서 MCP서버 커넥터 하나에서 모든것을 처리할 수 있도록 구성할 수 있습니다.
<br> <br>

먼저 MCP커넥터를 추가하기 위해 **[개요]** 에서 [도구] 섹션의 [+ 도구 추가]를 선택합니다.
이후 팝업창에서 **[모델 컨테스트 프로토콜]** 을 클릭하고 **[이메일 관리 MCP 서버]** 를 선택합니다.
<img width="1268" height="868" alt="image" src="https://github.com/user-attachments/assets/de790368-4eff-4f54-858e-660372e8a3b8" />


> MCP 서버도 커스텀 커넥터와 마찬가지로 **커넥터 인프라**를 활용 합니다. 따라서 도구 섹션에서 추가 및 관리를 합니다!
<br> <br>

최초 선택이 되면 아래와 같이 연결이 없는 것으로 표시가 되므로, 연결을 추가하고 [만들기] 를 눌러 계정 정보를 연결합니다. <br> ⚠️로그인에 사용되는 계정정보는, 실제 MCP 서버에서 메일을 발송할 때 이용하는 사용자의 계정정보입니다.
<img width="1085" height="797" alt="image" src="https://github.com/user-attachments/assets/47179d3f-9dc7-4536-9621-cd822b079a80" />
<img width="1124" height="792" alt="image" src="https://github.com/user-attachments/assets/5c5a2ac7-cf5a-491f-b489-b22d9e730e2e" />
<img width="743" height="707" alt="image" src="https://github.com/user-attachments/assets/b5282967-b56d-4028-86e9-7f3598be2ca0" />

사용자 계정 연결이 완료되면 [추가 및 구성]을 선택하여 에이전트에 MCP 도구를 추가합니다.

<img width="1077" height="783" alt="image" src="https://github.com/user-attachments/assets/ab4d5fe0-804d-4e73-8e73-9a4e5d67ab23" />

이메일 관리 MCP 서버가 정상적으로 추가되었다면 하단에 [도구] 에서
MCP 서버가 제공하는 기능을 확인할 수 있습니다.
<img width="722" height="494" alt="image" src="https://github.com/user-attachments/assets/2916b139-6b68-45c4-8721-a82c491492e4" />
> 만약 보이지 않는다면, 도구 섹션 우측의 새로고침 버튼을 클릭합니다.

이후 <추가 세부 정보> 를 선택하여 [사용할 자격증명]을 기존 **최종 사용자 자격 증명** 에서 **제작자 제공 자격 증명** 으로 변경한 후 저장합니다.
커넥터의 자격 증명을 제작자 제공 자격 증명으로 선택 할 경우, Agent 관리자가 설정한 계정 정보를 기반으로 커넥터가 동작합니다. <br> 최종 사용자 자격 증명으로 설정되어 있을 경우, Agent를 이용하는 End-user가 해당 도구를 이용할 때 최초로 인증 절차를 밟게되며 커넥터 사용 권한, 라이선스 등이 없을 경우 이용이 불가합니다.
<img width="899" height="951" alt="image" src="https://github.com/user-attachments/assets/d64649a6-aa61-4405-8848-1ecba3fcdeb8" />

테스트를 통해 메일 발송을 바로 확인할 수도 있지만
에이전트가 보다 구조화된 메일을 발송하기 위해 지침에 아레 메일 발송 규칙과 포멧을 붙여넣고 저장합니다.

```
#메일 포멧 샘플

- 아래 메일 예제 포멧을 참조하여 메일을 작성합니다.
 
<html><body style="font-family: 'Segoe UI', Arial, sans-serif; color: #222; background: #f9f9f9; padding: 24px;">
<div style="background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 32px; max-width: 800px; margin: auto;">

<h2 style="color: #2d6cdf;">✈️ 안녕하세요, Administrator- Chiwon Choi님!</h2>
<p>이라크 중고차 시장조사 출장 준비를 진심으로 응원합니다. 안전하고 성공적인 출장 되시길 바랍니다.</p>

---

<h3 style="color: #2d6cdf;">🇮🇶 국기</h3>
<img src="https://opendata.mofa.go.kr:8444/fileDownload/images/country_images/flags/169/20241014_141212609.png" alt="이라크 국기" style="max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 16px;" />

<h3 style="color: #2d6cdf;">🗺️ 국가정보</h3>
<ul>
  <li><strong>국가명:</strong> 이라크 (Iraq)</li>
  <li><strong>ISO 코드:</strong> IQ</li>
  <li><strong>대륙:</strong> 중동</li>
  <li><strong>통화:</strong> 이라크 디나르 (Iraqi Dinar, ID) (1$=1,300 ID, 중앙은행 기준, '24.10월)</li>
</ul>

<h3 style="color: #2d6cdf;">🗺️ 위치</h3>
<img src="https://opendata.mofa.go.kr:8444/fileDownload/images/country_images/maps/169/20220318_162732597.png" alt="이라크 지도" style="max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 16px;" />

<h3 style="color: #2d6cdf;">💹 경제현황</h3>
<ul>
  <li><strong>GDP:</strong> 2,508억 달러 (2023, World Bank)</li>
  <li><strong>1인당 GDP:</strong> 5,512달러 (2023, PPP 기준, World Bank)</li>
  <li><strong>GDP 성장률:</strong> -2.9% (2023, World Bank)</li>
  <li><strong>수출액:</strong> 1,151억 달러</li>
  <li><strong>수입액:</strong> 950억 달러</li>
</ul>

<h3 style="color: #2d6cdf;">🌪️ 자연 재해</h3>
<ul>
  <li>봄철 모래바람이 심할 수 있으니, 마스크 등 적절한 대비가 필요합니다.</li>
  <li>7~9월에는 낮 최고기온이 50도에 육박하는 날이 많으니, 외부 활동을 삼가고 충분한 수분 섭취와 휴식을 권장합니다.</li>
  <li>배수시설이 미비하여 강우량이 많지 않아도 도로 및 주택 침수 위험이 있습니다. 특히 북부 산악지대나 이란 국경지역의 강 주변은 홍수 위험이 있으니 주의 바랍니다.</li>
</ul>

<h3 style="color: #2d6cdf;">🚨 사건 사고 유형 및 대처방안</h3>
<ul>
  <li>ISIS 등 테러 조직의 잔당이 도심지에 잠복하거나, 사병 또는 폭격 등으로 위협이 지속되고 있습니다. 현지 치안 및 안전 정보는 대사관 홈페이지 등에서 최신 정보를 확인하시기 바랍니다.</li>
  <li>강력범죄(납치, 강도, 암살 등)가 빈번하므로, 현지인도 무장 경호를 고용하는 등 신변안전에 각별히 유의해야 합니다.</li>
  <li>외부 출타 시에는 반드시 무장 경호원을 동행하고, 방탄 차량을 이용하는 등 신변안전에 만전을 기해야 합니다.</li>
  <li>여행금지 국가로 지정되어 있으므로, 예외적으로 입국 시에는 예외적 여권 사용 허가가 필요합니다. 반드시 대사관 또는 현지 기관의 안내를 참고하시기 바랍니다.</li>
  <li>현금이나 몸값을 노린 납치 사건이 발생할 수 있으니, 납치 시에는 즉시 대사관에 연락하여 도움을 요청해야 합니다.</li>
  <li>야간 운전 및 비포장도로 운전은 위험하니, 현지 운전원 및 경호원과 동행을 권장합니다.</li>
</ul>

<h3 style="color: #2d6cdf;">📍 유의해야 할 지역</h3>
<ul>
  <li>이라크 내 모든 지역에서 신변안전에 유의해야 하나, 특히 Nineveh, Diyala, Salahuddin, Kirkuk, Anbar 주 및 바그다드 외곽지역 등은 IS 잔당의 테러공격이 빈번하니 절대 방문을 삼가시기 바랍니다.</li>
  <li>모스크, 시장, 정부기관 등 사람이 많이 모이는 곳에서는 불특정 다수를 상대로 한 자살폭탄 테러가 빈번하니 접근을 삼가시기 바랍니다.</li>
</ul>

<h3 style="color: #2d6cdf;">📝 주요 피해 사례 요약</h3>
<ul>
  <li>IS 잔당의 소규모 테러공격, 강력범죄(납치, 강도, 암살), 야간 및 비포장도로 교통사고, 외국인 근로자 대상 부적절한 합의 미이행 등 다양한 피해 사례가 보고되고 있습니다.</li>
</ul>

<h3 style="color: #2d6cdf;">🗺️ 위험지도</h3>
<img src="https://www.0404.go.kr/files/download/COUNTRY_174/3" alt="이라크 위험지도" style="max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 16px;" />

---
```
> Outlook 커넥터 또는 MCP 서버에서 메일을 보낼 때는 HTML 형식을 이용합니다.
지침에 HTML 형식으로 작성 또는 HTML 샘플을 포함하여 작성하도록 지침을 만들어 둘 경우, 메일의 레이아웃, 줄간격, 강조 등의 메일 시인성을 높일 수 있습니다.
<br> 
<img width="795" height="606" alt="image" src="https://github.com/user-attachments/assets/0fe97012-a22c-48ec-b635-38f068596590" />

<br> <br>

지침 추가가 완료되었으면 테스트를 통해 실제 아래 프롬프트를 이용하여 테스트를 통해, 위에서 선언한 형식 및 레이아웃에 맞게 회신을 하는지 확인해 봅니다.
```
핀란드에 대해 분석해줘
```

```
이 내용을  "메일 주소" 로 메일을 보내줘
```

<img width="1398" height="1264" alt="image" src="https://github.com/user-attachments/assets/6cfae7f3-5bff-4006-912f-cdc3f2c9aa64" />
<br> <br>

실제 아웃욱에 접속해서 보면 포멧이 사전에 지시한 대로 적용되어 메일이 작성된 것으 확인할 수 있습니다.
<img width="1485" height="1392" alt="image" src="https://github.com/user-attachments/assets/27e8afb7-15a0-4311-9ab0-a0165e7836fb" />

---

🎉🎉축하합니다🎉🎉 이번 세션을 완료하였습니다.
다음 세션에서는 트리거를 이용해 사용자가 직접 Copilot에 개입하지 않더라도 원하는 정보를 회신하는 자동화 에이전트 구현을 해 보도록 하겠습니다.
