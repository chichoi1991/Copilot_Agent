# ✅ Agent에 내부 데이터 참조 시키기

이번 세션에서는 Copilot Agent가 Sharepoint 사이트에 업로드된 자료들을 참조하여 답을 할 수 있도록, 참조자료를 설정해 보도록 합니다.

## 📘 1. 참조자료란?
Copilot Studio에서 **참조자료(Reference)** 는 플로우 설계 시 외부 데이터를 연결하여 응답의 정확성과 유연성을 높이는 기능입니다. 이를 통해 사용자의 질문에 대해 더 풍부하고 정확한 정보를 기반으로 응답할 수 있습니다.


## ✅ 2. 참조자료의 주요 목적

|목적|설명|
|-|-|
|🔍 정보 보강|외부 문서나 데이터베이스를 참조하여 더 정확한 답변 제공| 
|📄 문서 기반 응답 | FAQ, 정책 문서, 제품 설명서 등을 기반으로 자동 응답 생성 |
|🧠 지식 기반 연결 | 사내 위키, SharePoint, OneDrive, 웹사이트 등과 연동 가능 |

---

## 📂 3. 참조 가능한 자료 유형

|자료|유형설명|
|-|-|
|🌐 공개 웹 페이지 | 회사 홈페이지, 고객지원 페이지 등 |
| 🗃️ SharePoint / OneDrive | 내부 문서 저장소 |
| 📊 데이터베이스 | Azure SQL, Dataverse 등 구조화된 데이터 |
| 🧾 3rd party 솔루션 | Salesforce, ServiceNow 등과 같은 지식 저장소 |
|📄 Azure AI Search |이미 자체 구축한 AI Search 엔진 활용|

---

## ⚙️ 4. 참조자료 활용 방식

1. **플로우 내에서 참조자료 연결**
   - 특정 질문에 대해 참조자료를 기반으로 응답 생성
2. **질문 키워드 기반 검색**
   - 사용자의 질문과 관련된 문서 내 키워드를 검색하여 응답
3. **다중 참조자료 설정**
   - 여러 문서를 동시에 참조하여 종합적인 응답 제공

---

## 5. 실습
지금부터 참조자료 연결 실습을 해 보도록 합니다. 실습은 1번 세션에서 생성한 Agent를 이용하여 진행 합니다.<br> 

실습 시나리오는 다음과 같습니다.
- 쉐어포인트에 업로드된 국가코드정보.xlsx 파일을 Agent가 참조하여 사용자가 질문하는 국가에 대해 ISO 국가코드, 영문명, 하늘명, ISO 국가번호 등을 알려줍니다.
> **🚨🚨이 정보는 다음 세션에서 진행될 외부 API서버 조회에 이용될 키워드 입니다.🚨🚨**

> 쉐어포인트 사이트에 업로드된 파일을 열어보면 다음과 같이 업로드 되어 있습니다. <br> 
> 해당 파일은 [실습자료](https://github.com/chichoi1991/Copilot_Agent/tree/main/%EC%BB%A4%EC%8A%A4%ED%85%80%EC%97%94%EC%A7%84%20%EC%97%90%EC%9D%B4%EC%A0%84%ED%8A%B8%20%EC%8B%A4%EC%8A%B5/%EC%8B%A4%EC%8A%B5%20%EC%9E%90%EB%A3%8C) 에서 확인 및 다운로드 할 수 있습니다.
<img width="960" height="833" alt="image" src="https://github.com/user-attachments/assets/07625f64-33d2-4685-a422-0624d797480a" />

<br> <br>

먼저 에이전트 **[개요]** 에서 스크롤을 내려 **[참조 자료]** 란에 **[+참조 자료 추가]** 를 선택합니다. <br>
<img width="1011" height="657" alt="image" src="https://github.com/user-attachments/assets/589d0999-c260-4f59-9e1d-958415d633b1" />
<br><br>

참조 자료에 추가할 수 있는 서비스들이 표시가 됩니다.
이번 실습에서는 Sharepoint 사이트에 저장되어있는 엑셀의 데이터를 참조할 예정이므로 **[SharePoint]** 를 선택합니다.

<img width="1158" height="817" alt="image" src="https://github.com/user-attachments/assets/fd2afe41-77de-4f7b-9649-bec64f0d0967" />

찾아보기를 통해 **[국가코드정보.xlsx]** 파일을 선택하거나 아래의 쉐어포인트 사이트 링크를 직접 입력합니다. <br> 
<br> 
쉐어포인트 사이트 주소
```
https://lgcnscoltd551.sharepoint.com/Shared%20Documents/%E1%84%80%E1%85%AE%E1%86%A8%E1%84%80%E1%85%A1%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%87%E1%85%A9.xlsx
```
> 직접 입력시 "이 항목은 이 항목은 SharePoint 또는 OneDrive 파일에서 찾을 수 없습니다. **그래도 추가하시겠습니까?**"  <br>같은 경고문이 발생할 수 있습니다. **그래도 추가하시겠습니까?** 를 선택하여 Sharepoint 사이트를 등록합니다.
<img width="1119" height="798" alt="image" src="https://github.com/user-attachments/assets/2bef70bb-0dc5-4f19-9cb1-fcbea62f9c73" />
<br><br>

> 찾아보기를 통해 파일을 선택할 경우
<img width="1089" height="778" alt="image" src="https://github.com/user-attachments/assets/4cc5cb21-3ab4-4dfd-9885-d368b83d4ba9" />
<img width="1133" height="802" alt="image" src="https://github.com/user-attachments/assets/f16d6570-ef1b-4ef4-b272-3060006723c6" />

<br><br>

이후 참조자료의 이름과 설명을 아래와 같이 입력하고 **[에이전트에 추가]** 버튼을 클릭합니다.
> **📌📌중요📌📌** **Agent는 설명을 참조하여 참조자료의 검색과 결과물에 대해 어떻게 처리할지를 판단합니다.** 지침 작성 가이드 라인과 마찬가지로 데이터 포멧, 이해 방법, 처리 방식등을 잘 설명해야 합니다.
- 이름
```
국가정보
```
- 설명
```
전세계 국가에 대한 ISO 코드 정보가 기술되어 있습니다.  영문 이름(country_eng_nm) 한글 이름(country_iso_alp2), 2자리 iso 기호(country_iso_alp2), 3자리 iso 기호(iso_alp3), iso 번호(iso_num) 의 정보가 있습니다.
```
<br><br> 
<img width="1096" height="784" alt="image" src="https://github.com/user-attachments/assets/af0cfe2c-7316-426c-b142-0f0f854d3ddd" />

개요의 **[참조 자료]** 에 국가정보가 표시되고 **[준비]** 상태로 보이면 에이전트가 설정한 Sharepoint의 데이터를 활용할 수 있음을 의미합니다.
<br><br> 
추가된 데이터를 적절히 답변할 수 있도록 기존 지침을 아래 내용으로 변경 합니다.
```
- 사용자가 입력한 국가명을 바탕으로 쉐어포인트에서 해당 국가의 ISO 코드를 검색합니다.
- 사용자가 지정하지 않을 경우,  ISO 2자리 코드(iso_alp2) 를 검색하며, 사용자가 명시적으로 요청시에는 국가의 영어이름(country_eng_nm), 한글이름(country_nm), id, iso 3자리 코드(iso_alp3), iso 번호(iso_num) 를 제공합니다.
- ISO 2자리 코드가 확인되면 커넥터를 통해 해당 국가의 상세 정보(인구, 면적, 수도 등)를 제공함
- 사용자가 국가명을 잘못 입력했을 경우, 올바른 국가명을 안내하고 재입력을 요청함
- 최신 정보 제공을 위해 항상 쉐어포인트와 커넥터를 우선적으로 활용함
- 사용자 질문에 친절하고 명확하게 응답함
- 민감하거나 제한된 정보는 제공하지 않음
```
<br> <br> 

우측 상단의 [에이전트 테스트] 에서 새로고침을 하고 아래의 질문을 전송하여 정상적으로 쉐어포인트 데이터를 조회하여 답변을 하는지 확인해 봅니다.
> **📌📌중요📌📌** 기본적으로 설정, 지침, 커넥터 수정이 이루어지고 난 후, 정상적으로 동작하는지 테스트 할 때에는 <br> 반드시 에이전트 테스트에서 새로고침을 눌러서 기존 세션을 초기화하고 진행해야 새로 적용된 정보를 확인할 수 있습니다.
```
미국과 일본의 국가코드는?
```
<img width="603" height="225" alt="image" src="https://github.com/user-attachments/assets/8d017daa-4839-417a-b691-755dd07bb783" />
<br> <br> 

프롬프트가 입력되고 에이전트가 동작하기 시작하면 좌측 패널에는 [활동 지도]를 통해 에이전트가 어떤 작업을 수행하고 있는지 알 수 있습니다. <br>
목적이 쉐어포인트 데이터를 참조하여 답변을 하는것이기에, 에이전트 참조자료와 참조자료 원본을 [국가정보] 로 선택이 되었다면 정상적으로 동작하고 있음을 알 수 있습니다.
<img width="1650" height="1246" alt="image" src="https://github.com/user-attachments/assets/491f5a6a-18a6-4394-8899-50f2f138c7fd" />
> 만약 정상적으로 답변을 하지 못하고 있다면, 에이전트의 모델을 변경하시거나, 잠시후 시도해 주세요. 쉐어포인트에 데이터가 업로드된지 얼마 안되었을 경우, Semantic Index가 완료되지 않아 답변의 정확도가 떨어질 수 있습니다.

🎉🎉축하합니다🎉🎉
이번 세션을 완료하였습니다.
이제는 손쉽게 에이전트가 사내 데이터를 참조할수도록 구성하게 되었습니다.

**다음 세션에서는 이 데이터를 기반으로 외부의 API서버에 데이터를 호출하고 출력하는 지침을 만들어 봅니다.**
